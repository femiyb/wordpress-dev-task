"use strict";Object.defineProperty(exports, "__esModule", {value: true});"use client";


var _HOEZKRUMcjs = require('../__chunks/HOEZKRUM.cjs');
require('../__chunks/MYTMMWXI.cjs');
require('../__chunks/F6Q5QSXF.cjs');


var _AR2VJ37Fcjs = require('../__chunks/AR2VJ37F.cjs');
require('../__chunks/FFY2GSOG.cjs');






var _FJSZTIOUcjs = require('../__chunks/FJSZTIOU.cjs');


var _3UT5FE6Kcjs = require('../__chunks/3UT5FE6K.cjs');



var _G5EW4WEDcjs = require('../__chunks/G5EW4WED.cjs');
require('../__chunks/FTB5CXVB.cjs');
require('../__chunks/ULSPM3Y3.cjs');



var _AV6KTKLEcjs = require('../__chunks/AV6KTKLE.cjs');

// src/combobox/combobox-store.ts
var isSafariOnMobile = _G5EW4WEDcjs.isSafari.call(void 0, ) && _G5EW4WEDcjs.isTouchDevice.call(void 0, );
function createComboboxStore(props = {}) {
  var _a;
  _FJSZTIOUcjs.throwOnConflictingProps.call(void 0, props, props.store);
  const syncState = (_a = props.store) == null ? void 0 : _a.getState();
  const activeId = _3UT5FE6Kcjs.defaultValue.call(void 0, 
    props.activeId,
    syncState == null ? void 0 : syncState.activeId,
    props.defaultActiveId,
    null
  );
  const composite = _AR2VJ37Fcjs.createCompositeStore.call(void 0, _AV6KTKLEcjs.__spreadProps.call(void 0, _AV6KTKLEcjs.__spreadValues.call(void 0, {}, props), {
    activeId,
    includesBaseElement: _3UT5FE6Kcjs.defaultValue.call(void 0, 
      props.includesBaseElement,
      syncState == null ? void 0 : syncState.includesBaseElement,
      true
    ),
    orientation: _3UT5FE6Kcjs.defaultValue.call(void 0, 
      props.orientation,
      syncState == null ? void 0 : syncState.orientation,
      "vertical"
    ),
    focusLoop: _3UT5FE6Kcjs.defaultValue.call(void 0, props.focusLoop, syncState == null ? void 0 : syncState.focusLoop, true),
    focusWrap: _3UT5FE6Kcjs.defaultValue.call(void 0, props.focusWrap, syncState == null ? void 0 : syncState.focusWrap, true),
    virtualFocus: _3UT5FE6Kcjs.defaultValue.call(void 0, 
      props.virtualFocus,
      syncState == null ? void 0 : syncState.virtualFocus,
      !isSafariOnMobile
    )
  }));
  const popover = _HOEZKRUMcjs.createPopoverStore.call(void 0, _AV6KTKLEcjs.__spreadProps.call(void 0, _AV6KTKLEcjs.__spreadValues.call(void 0, {}, props), {
    placement: _3UT5FE6Kcjs.defaultValue.call(void 0, 
      props.placement,
      syncState == null ? void 0 : syncState.placement,
      "bottom-start"
    )
  }));
  const initialValue = _3UT5FE6Kcjs.defaultValue.call(void 0, 
    props.value,
    syncState == null ? void 0 : syncState.value,
    props.defaultValue,
    ""
  );
  const initialState = _AV6KTKLEcjs.__spreadProps.call(void 0, _AV6KTKLEcjs.__spreadValues.call(void 0, _AV6KTKLEcjs.__spreadValues.call(void 0, {}, composite.getState()), popover.getState()), {
    value: initialValue,
    resetValueOnHide: _3UT5FE6Kcjs.defaultValue.call(void 0, 
      props.resetValueOnHide,
      syncState == null ? void 0 : syncState.resetValueOnHide,
      false
    ),
    activeValue: syncState == null ? void 0 : syncState.activeValue
  });
  const combobox = _FJSZTIOUcjs.createStore.call(void 0, initialState, composite, popover, props.store);
  _FJSZTIOUcjs.setup.call(void 0, 
    combobox,
    () => _FJSZTIOUcjs.sync.call(void 0, combobox, ["resetValueOnHide", "mounted"], (state) => {
      if (!state.resetValueOnHide)
        return;
      if (state.mounted)
        return;
      combobox.setState("value", initialValue);
    })
  );
  _FJSZTIOUcjs.setup.call(void 0, 
    combobox,
    () => _FJSZTIOUcjs.batch.call(void 0, combobox, ["mounted"], (state) => {
      if (state.mounted)
        return;
      combobox.setState("activeId", activeId);
      combobox.setState("moves", 0);
    })
  );
  _FJSZTIOUcjs.setup.call(void 0, 
    combobox,
    () => _FJSZTIOUcjs.sync.call(void 0, combobox, ["moves", "activeId"], (state, prevState) => {
      if (state.moves === prevState.moves) {
        combobox.setState("activeValue", void 0);
      }
    })
  );
  _FJSZTIOUcjs.setup.call(void 0, 
    combobox,
    () => _FJSZTIOUcjs.batch.call(void 0, combobox, ["moves", "renderedItems"], (state, prev) => {
      if (state.moves === prev.moves)
        return;
      const { activeId: activeId2 } = combobox.getState();
      const activeItem = composite.item(activeId2);
      combobox.setState("activeValue", activeItem == null ? void 0 : activeItem.value);
    })
  );
  return _AV6KTKLEcjs.__spreadProps.call(void 0, _AV6KTKLEcjs.__spreadValues.call(void 0, _AV6KTKLEcjs.__spreadValues.call(void 0, _AV6KTKLEcjs.__spreadValues.call(void 0, {}, popover), composite), combobox), {
    setValue: (value) => combobox.setState("value", value)
  });
}


exports.createComboboxStore = createComboboxStore;
