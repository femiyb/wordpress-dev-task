{"version":3,"names":["createBlobURL","atob","File","window","imageCorrector","node","nodeName","src","indexOf","properties","data","split","type","slice","decoded","e","uint8Array","Uint8Array","length","i","charCodeAt","name","replace","file","height","width","parentNode","removeChild"],"sources":["@wordpress/blocks/src/api/raw-handling/image-corrector.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { createBlobURL } from '@wordpress/blob';\n\n/**\n * Browser dependencies\n */\nconst { atob, File } = window;\n\nexport default function imageCorrector( node ) {\n\tif ( node.nodeName !== 'IMG' ) {\n\t\treturn;\n\t}\n\n\tif ( node.src.indexOf( 'file:' ) === 0 ) {\n\t\tnode.src = '';\n\t}\n\n\t// This piece cannot be tested outside a browser env.\n\tif ( node.src.indexOf( 'data:' ) === 0 ) {\n\t\tconst [ properties, data ] = node.src.split( ',' );\n\t\tconst [ type ] = properties.slice( 5 ).split( ';' );\n\n\t\tif ( ! data || ! type ) {\n\t\t\tnode.src = '';\n\t\t\treturn;\n\t\t}\n\n\t\tlet decoded;\n\n\t\t// Can throw DOMException!\n\t\ttry {\n\t\t\tdecoded = atob( data );\n\t\t} catch ( e ) {\n\t\t\tnode.src = '';\n\t\t\treturn;\n\t\t}\n\n\t\tconst uint8Array = new Uint8Array( decoded.length );\n\n\t\tfor ( let i = 0; i < uint8Array.length; i++ ) {\n\t\t\tuint8Array[ i ] = decoded.charCodeAt( i );\n\t\t}\n\n\t\tconst name = type.replace( '/', '.' );\n\t\tconst file = new File( [ uint8Array ], name, { type } );\n\n\t\tnode.src = createBlobURL( file );\n\t}\n\n\t// Remove trackers and hardly visible images.\n\tif ( node.height === 1 || node.width === 1 ) {\n\t\tnode.parentNode.removeChild( node );\n\t}\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,aAAa,QAAQ,iBAAiB;;AAE/C;AACA;AACA;AACA,MAAM;EAAEC,IAAI;EAAEC;AAAK,CAAC,GAAGC,MAAM;AAE7B,eAAe,SAASC,cAAcA,CAAEC,IAAI,EAAG;EAC9C,IAAKA,IAAI,CAACC,QAAQ,KAAK,KAAK,EAAG;IAC9B;EACD;EAEA,IAAKD,IAAI,CAACE,GAAG,CAACC,OAAO,CAAE,OAAQ,CAAC,KAAK,CAAC,EAAG;IACxCH,IAAI,CAACE,GAAG,GAAG,EAAE;EACd;;EAEA;EACA,IAAKF,IAAI,CAACE,GAAG,CAACC,OAAO,CAAE,OAAQ,CAAC,KAAK,CAAC,EAAG;IACxC,MAAM,CAAEC,UAAU,EAAEC,IAAI,CAAE,GAAGL,IAAI,CAACE,GAAG,CAACI,KAAK,CAAE,GAAI,CAAC;IAClD,MAAM,CAAEC,IAAI,CAAE,GAAGH,UAAU,CAACI,KAAK,CAAE,CAAE,CAAC,CAACF,KAAK,CAAE,GAAI,CAAC;IAEnD,IAAK,CAAED,IAAI,IAAI,CAAEE,IAAI,EAAG;MACvBP,IAAI,CAACE,GAAG,GAAG,EAAE;MACb;IACD;IAEA,IAAIO,OAAO;;IAEX;IACA,IAAI;MACHA,OAAO,GAAGb,IAAI,CAAES,IAAK,CAAC;IACvB,CAAC,CAAC,OAAQK,CAAC,EAAG;MACbV,IAAI,CAACE,GAAG,GAAG,EAAE;MACb;IACD;IAEA,MAAMS,UAAU,GAAG,IAAIC,UAAU,CAAEH,OAAO,CAACI,MAAO,CAAC;IAEnD,KAAM,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,UAAU,CAACE,MAAM,EAAEC,CAAC,EAAE,EAAG;MAC7CH,UAAU,CAAEG,CAAC,CAAE,GAAGL,OAAO,CAACM,UAAU,CAAED,CAAE,CAAC;IAC1C;IAEA,MAAME,IAAI,GAAGT,IAAI,CAACU,OAAO,CAAE,GAAG,EAAE,GAAI,CAAC;IACrC,MAAMC,IAAI,GAAG,IAAIrB,IAAI,CAAE,CAAEc,UAAU,CAAE,EAAEK,IAAI,EAAE;MAAET;IAAK,CAAE,CAAC;IAEvDP,IAAI,CAACE,GAAG,GAAGP,aAAa,CAAEuB,IAAK,CAAC;EACjC;;EAEA;EACA,IAAKlB,IAAI,CAACmB,MAAM,KAAK,CAAC,IAAInB,IAAI,CAACoB,KAAK,KAAK,CAAC,EAAG;IAC5CpB,IAAI,CAACqB,UAAU,CAACC,WAAW,CAAEtB,IAAK,CAAC;EACpC;AACD"}